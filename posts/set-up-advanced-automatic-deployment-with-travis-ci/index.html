<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 Travis-CI 完成高级的自动化部署 | Two Cold</title><meta name=keywords content="Travis-CI,网站部署"><meta name=description content="会啰嗦几句简单介绍下然后实战
 写代码经常要花很多时间在构建和部署上面，像是我的个人网站、博客系统或者是一些小项目，每次有些改动就得去重新构建生产代码，改完之后还要把它弄上服务器，更新到线上去。
项目一多，改动一多，懒惰的我，就会把它“堆起来”，等一个比较长的开发周期结束之后，再去更新线上。虽然这样减少了更新的次数，但依然还是又累又耗费时间。身为高贵的程序员不能再总是浪费生命干这种活了，必须要找个苦力给我搞定它。
通过 Google 发现 Travis CI 是最合适的选择。
什么是 CI CI 即持续集成服务，是 Continuous Integration 的简称，而 Travis CI 是提供这种服务里面市场份额最大的那个。
 之前开发 Electron 应用，需要 windows 环境构建，但因为 Travis CI 不支持 windows 环境，还一起用过 appveyor。appveyor 也是提供 CI 服务的。不过后来看到新闻，说 Travis CI 开始支持 windows 了，不过我还没试过。
 持续集成就是在团队开发的时候，成员们持续（频繁）将代码改动集成到主干上去。而每次集成都是通过自动化的构建（包括编译，发布，自动化测试）来验证。
持续集成的好处在于，每次代码的小幅变更，就能看到运行pt addo结果，从而也能尽早的发现集成错误。这样子就能不断累积小的变更，而不是在开发周期结束时，一下子合并一大块代码。
Travis CI 和 Github 账号绑定，你可以选择需要持续集成的项目，之后只要这个项目有代码变动，就会自动抓取，然后提供一个运行环境，执行测试，完成构建，然后也能部署到服务器上去。
.travis.yml 在 官网，点击右上角的个人头像，可以使用 Github 账户登入 Travis CI。然后便可以选择需要同步的项目。
这个同步的项目必须要有一个 .travis.yml 文件，是 Travis.yml 的配置文件，文件格式是 YAML 格式。它指定了 Travis 的行为。该文件必须 push 到 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。一般它是下面这样的"><meta name=author content="vdorchan"><link rel=canonical href=https://vdorchan.github.io/posts/set-up-advanced-automatic-deployment-with-travis-ci/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.min.04512c372388e08b5118f5b117b2d3efef4ddae52017e16085c8d8d4e361c43d.css integrity="sha256-BFEsNyOI4ItRGPWxF7LT7+9N2uUgF+FghcjY1ONhxD0=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://vdorchan.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://vdorchan.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://vdorchan.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://vdorchan.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://vdorchan.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="使用 Travis-CI 完成高级的自动化部署"><meta property="og:description" content="会啰嗦几句简单介绍下然后实战
 写代码经常要花很多时间在构建和部署上面，像是我的个人网站、博客系统或者是一些小项目，每次有些改动就得去重新构建生产代码，改完之后还要把它弄上服务器，更新到线上去。
项目一多，改动一多，懒惰的我，就会把它“堆起来”，等一个比较长的开发周期结束之后，再去更新线上。虽然这样减少了更新的次数，但依然还是又累又耗费时间。身为高贵的程序员不能再总是浪费生命干这种活了，必须要找个苦力给我搞定它。
通过 Google 发现 Travis CI 是最合适的选择。
什么是 CI CI 即持续集成服务，是 Continuous Integration 的简称，而 Travis CI 是提供这种服务里面市场份额最大的那个。
 之前开发 Electron 应用，需要 windows 环境构建，但因为 Travis CI 不支持 windows 环境，还一起用过 appveyor。appveyor 也是提供 CI 服务的。不过后来看到新闻，说 Travis CI 开始支持 windows 了，不过我还没试过。
 持续集成就是在团队开发的时候，成员们持续（频繁）将代码改动集成到主干上去。而每次集成都是通过自动化的构建（包括编译，发布，自动化测试）来验证。
持续集成的好处在于，每次代码的小幅变更，就能看到运行pt addo结果，从而也能尽早的发现集成错误。这样子就能不断累积小的变更，而不是在开发周期结束时，一下子合并一大块代码。
Travis CI 和 Github 账号绑定，你可以选择需要持续集成的项目，之后只要这个项目有代码变动，就会自动抓取，然后提供一个运行环境，执行测试，完成构建，然后也能部署到服务器上去。
.travis.yml 在 官网，点击右上角的个人头像，可以使用 Github 账户登入 Travis CI。然后便可以选择需要同步的项目。
这个同步的项目必须要有一个 .travis.yml 文件，是 Travis.yml 的配置文件，文件格式是 YAML 格式。它指定了 Travis 的行为。该文件必须 push 到 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。一般它是下面这样的"><meta property="og:type" content="article"><meta property="og:url" content="https://vdorchan.github.io/posts/set-up-advanced-automatic-deployment-with-travis-ci/"><meta property="og:image" content><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-04-18T10:32:01+00:00"><meta property="article:modified_time" content="2019-04-18T10:32:01+00:00"><meta property="og:site_name" content="Two Cold"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content><meta name=twitter:title content="使用 Travis-CI 完成高级的自动化部署"><meta name=twitter:description content="会啰嗦几句简单介绍下然后实战
 写代码经常要花很多时间在构建和部署上面，像是我的个人网站、博客系统或者是一些小项目，每次有些改动就得去重新构建生产代码，改完之后还要把它弄上服务器，更新到线上去。
项目一多，改动一多，懒惰的我，就会把它“堆起来”，等一个比较长的开发周期结束之后，再去更新线上。虽然这样减少了更新的次数，但依然还是又累又耗费时间。身为高贵的程序员不能再总是浪费生命干这种活了，必须要找个苦力给我搞定它。
通过 Google 发现 Travis CI 是最合适的选择。
什么是 CI CI 即持续集成服务，是 Continuous Integration 的简称，而 Travis CI 是提供这种服务里面市场份额最大的那个。
 之前开发 Electron 应用，需要 windows 环境构建，但因为 Travis CI 不支持 windows 环境，还一起用过 appveyor。appveyor 也是提供 CI 服务的。不过后来看到新闻，说 Travis CI 开始支持 windows 了，不过我还没试过。
 持续集成就是在团队开发的时候，成员们持续（频繁）将代码改动集成到主干上去。而每次集成都是通过自动化的构建（包括编译，发布，自动化测试）来验证。
持续集成的好处在于，每次代码的小幅变更，就能看到运行pt addo结果，从而也能尽早的发现集成错误。这样子就能不断累积小的变更，而不是在开发周期结束时，一下子合并一大块代码。
Travis CI 和 Github 账号绑定，你可以选择需要持续集成的项目，之后只要这个项目有代码变动，就会自动抓取，然后提供一个运行环境，执行测试，完成构建，然后也能部署到服务器上去。
.travis.yml 在 官网，点击右上角的个人头像，可以使用 Github 账户登入 Travis CI。然后便可以选择需要同步的项目。
这个同步的项目必须要有一个 .travis.yml 文件，是 Travis.yml 的配置文件，文件格式是 YAML 格式。它指定了 Travis 的行为。该文件必须 push 到 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。一般它是下面这样的"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://vdorchan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"使用 Travis-CI 完成高级的自动化部署","item":"https://vdorchan.github.io/posts/set-up-advanced-automatic-deployment-with-travis-ci/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 Travis-CI 完成高级的自动化部署","name":"使用 Travis-CI 完成高级的自动化部署","description":"会啰嗦几句简单介绍下然后实战\n 写代码经常要花很多时间在构建和部署上面，像是我的个人网站、博客系统或者是一些小项目，每次有些改动就得去重新构建生产代码，改完之后还要把它弄上服务器，更新到线上去。\n项目一多，改动一多，懒惰的我，就会把它“堆起来”，等一个比较长的开发周期结束之后，再去更新线上。虽然这样减少了更新的次数，但依然还是又累又耗费时间。身为高贵的程序员不能再总是浪费生命干这种活了，必须要找个苦力给我搞定它。\n通过 Google 发现 Travis CI 是最合适的选择。\n什么是 CI CI 即持续集成服务，是 Continuous Integration 的简称，而 Travis CI 是提供这种服务里面市场份额最大的那个。\n 之前开发 Electron 应用，需要 windows 环境构建，但因为 Travis CI 不支持 windows 环境，还一起用过 appveyor。appveyor 也是提供 CI 服务的。不过后来看到新闻，说 Travis CI 开始支持 windows 了，不过我还没试过。\n 持续集成就是在团队开发的时候，成员们持续（频繁）将代码改动集成到主干上去。而每次集成都是通过自动化的构建（包括编译，发布，自动化测试）来验证。\n持续集成的好处在于，每次代码的小幅变更，就能看到运行pt addo结果，从而也能尽早的发现集成错误。这样子就能不断累积小的变更，而不是在开发周期结束时，一下子合并一大块代码。\nTravis CI 和 Github 账号绑定，你可以选择需要持续集成的项目，之后只要这个项目有代码变动，就会自动抓取，然后提供一个运行环境，执行测试，完成构建，然后也能部署到服务器上去。\n.travis.yml 在 官网，点击右上角的个人头像，可以使用 Github 账户登入 Travis CI。然后便可以选择需要同步的项目。\n这个同步的项目必须要有一个 .travis.yml 文件，是 Travis.yml 的配置文件，文件格式是 YAML 格式。它指定了 Travis 的行为。该文件必须 push 到 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。一般它是下面这样的","keywords":["Travis-CI","网站部署"],"articleBody":" 会啰嗦几句简单介绍下然后实战\n 写代码经常要花很多时间在构建和部署上面，像是我的个人网站、博客系统或者是一些小项目，每次有些改动就得去重新构建生产代码，改完之后还要把它弄上服务器，更新到线上去。\n项目一多，改动一多，懒惰的我，就会把它“堆起来”，等一个比较长的开发周期结束之后，再去更新线上。虽然这样减少了更新的次数，但依然还是又累又耗费时间。身为高贵的程序员不能再总是浪费生命干这种活了，必须要找个苦力给我搞定它。\n通过 Google 发现 Travis CI 是最合适的选择。\n什么是 CI CI 即持续集成服务，是 Continuous Integration 的简称，而 Travis CI 是提供这种服务里面市场份额最大的那个。\n 之前开发 Electron 应用，需要 windows 环境构建，但因为 Travis CI 不支持 windows 环境，还一起用过 appveyor。appveyor 也是提供 CI 服务的。不过后来看到新闻，说 Travis CI 开始支持 windows 了，不过我还没试过。\n 持续集成就是在团队开发的时候，成员们持续（频繁）将代码改动集成到主干上去。而每次集成都是通过自动化的构建（包括编译，发布，自动化测试）来验证。\n持续集成的好处在于，每次代码的小幅变更，就能看到运行pt addo结果，从而也能尽早的发现集成错误。这样子就能不断累积小的变更，而不是在开发周期结束时，一下子合并一大块代码。\nTravis CI 和 Github 账号绑定，你可以选择需要持续集成的项目，之后只要这个项目有代码变动，就会自动抓取，然后提供一个运行环境，执行测试，完成构建，然后也能部署到服务器上去。\n.travis.yml 在 官网，点击右上角的个人头像，可以使用 Github 账户登入 Travis CI。然后便可以选择需要同步的项目。\n这个同步的项目必须要有一个 .travis.yml 文件，是 Travis.yml 的配置文件，文件格式是 YAML 格式。它指定了 Travis 的行为。该文件必须 push 到 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。一般它是下面这样的\nlanguage: python script: true 上面代码设置了两个字段，language字段指定了默认运行环境，这里设定使用 Python 环境。script字段指定要运行的脚本，script: true 表示不执行任何脚本，状态直接设为成功。\nTravis CI 的完整生命周期为（参考官方文档）：\n 可选的 Install apt addons 可选的 Install cache components before_install install before_script script 可选的 before_cache (for cleaning up cache) after_success 或 after_failure 可选的 before_deploy 可选的 deploy 可选的 after_deploy after_script   注意当使用 install 指定脚本的时候，要确保使用 chmod +x 给予可执行的权限。\n 其中 install 指定安装脚本， script 指定构建或测试脚本。\nlanguage: python install: - command1 - command2 script: - command1 - command2 install 指定的脚本如果有多个，然后前面有脚本执行失败，构建就会停下来并标记为错误，不再往下进行。\n而 script 则是会继续执行后面的脚本，如果你想要在第一个命令失败时不要执行第二个命令，你可以这么写\nscript: - command1 \u0026\u0026 command2 构建失败   如果 before_install, install 或者 before_script 返回一个非 0 的退出代码（exited code），构建会报错并且立刻中断。\n  如果 script 返回一个非 0 的退出代码（exited code），会在整个 script 流程结束后标记会构建失败，在这之前，即使前面命令报错，后面命令也会继续执行。\n  after_success, after_failure, after_script, after_deploy 和后面的流程不会影响构建结果，但是如果其中有一个流程超时了，构建会被标记会失败。\n  部署 Vue Spa 现在我正在开发一个名为 vue-movie 的 vue 单页面应用，并需要将它部署到服务器。\n在使用 CI 工具之前，工作流程大致是\n 本地通过 yarn serve 开发代码 代码开发调试没问题后，执行 yarn build 构建生产代码并 git push 到 Github 上 用 rsync（一个远程数据同步工具）部署到线上（这里省略 ssh 验证步骤）  现在我要让 CI 服务帮我做 2 和 3\ncd vue-movie vi .travis.yml .travis.yml 内容如下，包括指定运行环境的语言、指定只构建 master 分支，指定安装命令和构建命令\nlanguage: node_js node_js: - 10 branches: only: - master install: npm i -g yarn \u0026\u0026 yarn \u0026\u0026 yarn build script: - rsync -avu --progress --delete dist/ root@vdorchan.com:/srv/www/proj.vdorchan.com/vue-movie/ rsync 部分选项\n rsync [OPTION]… SRC DEST -a, –archive 归档模式，表示以递归方式传输文件，并保持所有文件属性 -v, –verbose 详细模式输出 -u, –update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件，不覆盖更新的文件。 –progress 显示备份过程 –delete 删除那些DST中SRC没有的文件\n 上面的 rsync 命令将项目的 dist 目录和远程服务器上的 /srv/www/proj.vdorchan.com/vue-movie/ 目录进行同步，远程服务器地址为 vdorchan.com\nssh 当进行远程同步的时候，是通过 ssh 网络协议进行传输的，ssh 以非对称加密实现身份验证。常见的做法是人工生成一对公钥和私钥，通过生成的密钥进行认证，这样就可以在不输入密码的情况下登录。\n除了默认添加的 github.com，gist.github.com 或 ssh.github.com，和其它服务器进行 ssh 传输时，都需要手动生成密钥。\n如果你使用的电脑有向你的 github 仓库 push 过代码，那么你应该使用过下面的命令生成过密钥了\nssh-keygen -t rsa -C \"vdorchan@gmail.com\" -t 指定密钥类型，-C 为注释，换成你自己的邮箱即可\n期间会问一些东西，使用默认值，一路回车就可以了，然后进入用户主目录下的 .ssh 文件夹，你就能看到 id_rsa 和 id_rsa.pub 两个文件，id_rsa 是私钥，绝对不能泄漏。id_rsa.pub 则是配套的公钥。\n$ cd ~/.ssh $ ls id_rsa id_rsa.pub 然后要将你的公钥 id_rsa.pub 放到服务器上去\n客户端执行，然后复制\ncat id_rsa.pub 服务器执行，创建文件，并编辑粘贴公钥内容\nvi ~/.ssh/authorized_keys 当然你也可以用更高端大气的方式，比如使用 scp 等等。\ntravis 加密文件 在 CI 环境里要想和服务器通信，那么就要把私钥放到 CI 环境里，但前面说过，私钥不能泄露，所以也就不能直接放在 github仓库里。我们要利用 travis CI 官方提供的加密文件的工具来进行加密。\n首先需要安装 travis 命令行工具，Mac os 用户可以直接使用 brew 安装\nbrew install travis # 或 gem install travis 安装如有问题，可参考官方仓库\n在项目目录下，使用 travis 的加密文件功能，将私钥进行加密。\ncd vue-movie travis encrypt-file ~/.ssh/id_rsa --add 这时候目录下就会出现 id_rsa.enc 这么一个文件，并且在 .travis.yml 文件中会加入下面这些代码\nbefore_install: - openssl aes-256-cbc -K $encrypted_0ad490829f5d_key -iv $encrypted_0ad490829f5d_iv -in id_rsa.enc -out ~/.ssh/id_rsa -d 上面代码是利用生成的文件和环境变量进行解密得到密钥。\n如果有些默认生成的代码是这样子的话，会报错，因为多了 \\，去掉就好\n-out ~\\/.ssh/id_rsa -d # 去掉 “ \\ ” 即可 -out ~/.ssh/id_rsa -d 阻止询问公钥 当第一次使用 ssh 传输文件的时候，系统会进行询问\nThe authenticity of host ’35.241.118.163 (35.241.118.163)’ can’t be established. ECDSA key fingerprint is 60:9c:a8:53:07:52:b9:b4:9f:fb:a2:57:53:be:5e:00. Are you sure you want to continue connecting 因为 CI 是自动化的，如果有交互式提示就无法进行下去来，所以要阻止它询问\naddons: ssh_known_hosts: vdorchan.com 上面代码将你的服务器域名添加上去\n你可能会遇到这样的权限问题 Permissions 0664 for ‘/home/travis/.ssh/id_rsa’ are too open. 补充如下代码即可解决\nbefore_install: - openssl aes-256-cbc -K $encrypted_0ad490829f5d_key -iv $encrypted_0ad490829f5d_iv -in id_rsa.enc -out ~/.ssh/id_rsa -d - chmod 600 ~/.ssh/id_rsa 完成上述的操作之后，你的代码应该就能自动化的部署了。不是很难，确保每个步骤无误，就肯定没问题了。如果还有问题，可以 Google、看官方文档，也可以问我。\n代码可见 https://github.com/vdorchan/vue-movie\n","wordCount":"444","inLanguage":"en","datePublished":"2019-04-18T10:32:01Z","dateModified":"2019-04-18T10:32:01Z","author":{"@type":"Person","name":"vdorchan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://vdorchan.github.io/posts/set-up-advanced-automatic-deployment-with-travis-ci/"},"publisher":{"@type":"Organization","name":"Two Cold","logo":{"@type":"ImageObject","url":"https://vdorchan.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://vdorchan.github.io/ accesskey=h title="Two Cold (Alt + H)">Two Cold</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://vdorchan.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://vdorchan.github.io/project/ title=作品><span>作品</span></a></li><li><a href=https://vdorchan.github.io/archive/ title=归档><span>归档</span></a></li><li><a href=https://vdorchan.github.io/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://vdorchan.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://vdorchan.github.io/posts/>Posts</a></div><h1 class=post-title>使用 Travis-CI 完成高级的自动化部署</h1><div class=post-meta>April 18, 2019&nbsp;·&nbsp;3 min&nbsp;·&nbsp;vdorchan&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/set-up-advanced-automatic-deployment-with-Travis-CI.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><blockquote><p>会啰嗦几句简单介绍下然后实战</p></blockquote><p>写代码经常要花很多时间在构建和部署上面，像是我的个人网站、博客系统或者是一些小项目，每次有些改动就得去重新构建生产代码，改完之后还要把它弄上服务器，更新到线上去。</p><p>项目一多，改动一多，懒惰的我，就会把它“堆起来”，等一个比较长的开发周期结束之后，再去更新线上。虽然这样减少了更新的次数，但依然还是又累又耗费时间。身为高贵的程序员不能再总是浪费生命干这种活了，必须要找个苦力给我搞定它。</p><p>通过 Google 发现 Travis CI 是最合适的选择。</p><h2 id=什么是-ci>什么是 CI<a hidden class=anchor aria-hidden=true href=#什么是-ci>#</a></h2><p>CI 即<em>持续集成服务</em>，是 Continuous Integration 的简称，而 Travis CI 是提供这种服务里面市场份额最大的那个。</p><blockquote><p>之前开发 Electron 应用，需要 windows 环境构建，但因为 Travis CI 不支持 windows 环境，还一起用过 appveyor。appveyor 也是提供 CI 服务的。不过后来看到新闻，说 Travis CI 开始支持 windows 了，不过我还没试过。</p></blockquote><p>持续集成就是在团队开发的时候，成员们持续（频繁）将代码改动集成到主干上去。而每次集成都是通过自动化的构建（包括编译，发布，自动化测试）来验证。</p><p>持续集成的好处在于，每次代码的小幅变更，就能看到运行pt addo结果，从而也能尽早的发现集成错误。这样子就能不断累积小的变更，而不是在开发周期结束时，一下子合并一大块代码。</p><p>Travis CI 和 Github 账号绑定，你可以选择需要持续集成的项目，之后只要这个项目有代码变动，就会自动抓取，然后提供一个运行环境，执行测试，完成构建，然后也能部署到服务器上去。</p><h2 id=travisyml>.travis.yml<a hidden class=anchor aria-hidden=true href=#travisyml>#</a></h2><p>在 <a href=https://travis-ci.com/>官网</a>，点击右上角的个人头像，可以使用 Github 账户登入 Travis CI。然后便可以选择需要同步的项目。</p><p>这个同步的项目必须要有一个 <code>.travis.yml</code> 文件，是 Travis.yml 的配置文件，文件格式是 <code>YAML</code> 格式。它指定了 Travis 的行为。该文件必须 push 到 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。一般它是下面这样的</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>language</span>: <span style=color:#ae81ff>python</span>
<span style=color:#f92672>script</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><p>上面代码设置了两个字段，<code>language</code>字段指定了默认运行环境，这里设定使用 <code>Python</code> 环境。<code>script</code>字段指定要运行的脚本，<code>script: true</code> 表示不执行任何脚本，状态直接设为成功。</p><p>Travis CI 的完整生命周期为（参考<a href=https://docs.travis-ci.com/user/job-lifecycle/#the-job-lifecycle>官方文档</a>）：</p><ol><li>可选的 <code>Install apt addons</code></li><li>可选的 <code>Install cache components</code></li><li><code>before_install</code></li><li><code>install</code></li><li><code>before_script</code></li><li><code>script</code></li><li>可选的 <code>before_cache</code> (for cleaning up cache)</li><li><code>after_success</code> 或 <code>after_failure</code></li><li>可选的 <code>before_deploy</code></li><li>可选的 <code>deploy</code></li><li>可选的 <code>after_deploy</code></li><li><code>after_script</code></li></ol><blockquote><p>注意当使用 <code>install</code> 指定脚本的时候，要确保使用 <code>chmod +x</code> 给予可执行的权限。</p></blockquote><p>其中 <code>install</code> 指定安装脚本， <code>script</code> 指定构建或测试脚本。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>language</span>: <span style=color:#ae81ff>python</span>
<span style=color:#f92672>install</span>:
  - <span style=color:#ae81ff>command1</span>
  - <span style=color:#ae81ff>command2</span>
<span style=color:#f92672>script</span>:
  - <span style=color:#ae81ff>command1</span>
  - <span style=color:#ae81ff>command2</span>
</code></pre></div><p><code>install</code> 指定的脚本如果有多个，然后前面有脚本执行失败，构建就会停下来并标记为错误，不再往下进行。</p><p>而 <code>script</code> 则是会继续执行后面的脚本，如果你想要在第一个命令失败时不要执行第二个命令，你可以这么写</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>script</span>:
  - <span style=color:#ae81ff>command1 &amp;&amp; command2</span>
</code></pre></div><h2 id=构建失败>构建失败<a hidden class=anchor aria-hidden=true href=#构建失败>#</a></h2><ul><li><p>如果 <code>before_install</code>, <code>install</code> 或者 <code>before_script</code> 返回一个非 0 的退出代码（exited code），构建会报错并且立刻中断。</p></li><li><p>如果 <code>script</code> 返回一个非 0 的退出代码（exited code），会在整个 <code>script</code> 流程结束后标记会构建失败，在这之前，即使前面命令报错，后面命令也会继续执行。</p></li><li><p><code>after_success</code>, <code>after_failure</code>, <code>after_script</code>, <code>after_deploy</code> 和后面的流程不会影响构建结果，但是如果其中有一个流程超时了，构建会被标记会失败。</p></li></ul><h2 id=部署-vue-spa>部署 Vue Spa<a hidden class=anchor aria-hidden=true href=#部署-vue-spa>#</a></h2><p>现在我正在开发一个名为 vue-movie 的 vue 单页面应用，并需要将它部署到服务器。</p><p>在使用 CI 工具之前，工作流程大致是</p><ol><li>本地通过 <code>yarn serve</code> 开发代码</li><li>代码开发调试没问题后，执行 <code>yarn build</code> 构建生产代码并 <code>git push</code> 到 Github 上</li><li>用 rsync（一个远程数据同步工具）部署到线上（这里省略 ssh 验证步骤）</li></ol><p>现在我要让 CI 服务帮我做 2 和 3</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd vue-movie
vi .travis.yml
</code></pre></div><p>.travis.yml 内容如下，包括指定运行环境的语言、指定只构建 master 分支，指定安装命令和构建命令</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>language</span>: <span style=color:#ae81ff>node_js</span>
<span style=color:#f92672>node_js</span>:
- <span style=color:#ae81ff>10</span>
<span style=color:#f92672>branches</span>:
  <span style=color:#f92672>only</span>:
  - <span style=color:#ae81ff>master</span>
<span style=color:#f92672>install</span>: <span style=color:#ae81ff>npm i -g yarn &amp;&amp; yarn &amp;&amp; yarn build</span>
<span style=color:#f92672>script</span>:
- <span style=color:#ae81ff>rsync -avu --progress --delete dist/ root@vdorchan.com:/srv/www/proj.vdorchan.com/vue-movie/</span>
</code></pre></div><p>rsync 部分选项</p><blockquote><p>rsync [OPTION]&mldr; SRC DEST
-a, &ndash;archive 归档模式，表示以递归方式传输文件，并保持所有文件属性
-v, &ndash;verbose 详细模式输出
-u, &ndash;update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件，不覆盖更新的文件。
&ndash;progress 显示备份过程
&ndash;delete 删除那些DST中SRC没有的文件</p></blockquote><p>上面的 rsync 命令将项目的 dist 目录和远程服务器上的 <code>/srv/www/proj.vdorchan.com/vue-movie/</code> 目录进行同步，远程服务器地址为 vdorchan.com</p><h3 id=ssh>ssh<a hidden class=anchor aria-hidden=true href=#ssh>#</a></h3><p>当进行远程同步的时候，是通过 ssh 网络协议进行传输的，ssh 以非对称加密实现身份验证。常见的做法是人工生成一对公钥和私钥，通过生成的密钥进行认证，这样就可以在不输入密码的情况下登录。</p><p>除了默认添加的 github.com，gist.github.com 或 ssh.github.com，和其它服务器进行 ssh 传输时，都需要手动生成密钥。</p><p>如果你使用的电脑有向你的 github 仓库 push 过代码，那么你应该使用过下面的命令生成过密钥了</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh-keygen -t rsa -C <span style=color:#e6db74>&#34;vdorchan@gmail.com&#34;</span>
</code></pre></div><p>-t 指定密钥类型，-C 为注释，换成你自己的邮箱即可</p><p>期间会问一些东西，使用默认值，一路回车就可以了，然后进入用户主目录下的 .ssh 文件夹，你就能看到 <code>id_rsa</code> 和 <code>id_rsa.pub</code> 两个文件，id_rsa 是私钥，绝对不能泄漏。id_rsa.pub 则是配套的公钥。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cd ~/.ssh
$ ls
id_rsa id_rsa.pub
</code></pre></div><p>然后要将你的公钥 <code>id_rsa.pub</code> 放到服务器上去</p><p>客户端执行，然后复制</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat id_rsa.pub
</code></pre></div><p>服务器执行，创建文件，并编辑粘贴公钥内容</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vi ~/.ssh/authorized_keys
</code></pre></div><p>当然你也可以用更高端大气的方式，比如使用 <code>scp</code> 等等。</p><h3 id=travis-加密文件>travis 加密文件<a hidden class=anchor aria-hidden=true href=#travis-加密文件>#</a></h3><p>在 CI 环境里要想和服务器通信，那么就要把私钥放到 CI 环境里，但前面说过，私钥不能泄露，所以也就不能直接放在 github仓库里。我们要利用 travis CI 官方提供的加密文件的工具来进行加密。</p><p>首先需要安装 travis 命令行工具，Mac os 用户可以直接使用 brew 安装</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>brew install travis

<span style=color:#75715e># 或</span>
gem install travis
</code></pre></div><p>安装如有问题，可参考<a href=https://github.com/travis-ci/travis.rb>官方仓库</a></p><p>在项目目录下，使用 travis 的加密文件功能，将私钥进行加密。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd vue-movie
travis encrypt-file ~/.ssh/id_rsa --add
</code></pre></div><p>这时候目录下就会出现 <code>id_rsa.enc</code> 这么一个文件，并且在 .travis.yml 文件中会加入下面这些代码</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>before_install</span>:
- <span style=color:#ae81ff>openssl aes-256-cbc -K $encrypted_0ad490829f5d_key -iv $encrypted_0ad490829f5d_iv</span>
  -<span style=color:#ae81ff>in id_rsa.enc -out ~/.ssh/id_rsa -d</span>
</code></pre></div><p>上面代码是利用生成的文件和环境变量进行解密得到密钥。</p><p>如果有些默认生成的代码是这样子的话，会报错，因为多了 <code>\</code>，去掉就好</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML> -<span style=color:#ae81ff>out ~\/.ssh/id_rsa -d</span>

 <span style=color:#75715e># 去掉 “ \ ” 即可</span>
 -<span style=color:#ae81ff>out ~/.ssh/id_rsa -d</span>
</code></pre></div><h2 id=阻止询问公钥>阻止询问公钥<a hidden class=anchor aria-hidden=true href=#阻止询问公钥>#</a></h2><p>当第一次使用 ssh 传输文件的时候，系统会进行询问</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>The authenticity of host ’35.241.118.163 <span style=color:#f92672>(</span>35.241.118.163<span style=color:#f92672>)</span>’ can’t be established.
ECDSA key fingerprint is 60:9c:a8:53:07:52:b9:b4:9f:fb:a2:57:53:be:5e:00.
Are you sure you want to <span style=color:#66d9ef>continue</span> connecting
</code></pre></div><p>因为 CI 是自动化的，如果有交互式提示就无法进行下去来，所以要阻止它询问</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>addons</span>:
  <span style=color:#f92672>ssh_known_hosts</span>: <span style=color:#ae81ff>vdorchan.com</span>
</code></pre></div><p>上面代码将你的服务器域名添加上去</p><h3 id=你可能会遇到这样的权限问题>你可能会遇到这样的权限问题<a hidden class=anchor aria-hidden=true href=#你可能会遇到这样的权限问题>#</a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Permissions <span style=color:#ae81ff>0664</span> <span style=color:#66d9ef>for</span> ‘/home/travis/.ssh/id_rsa’ are too open.
</code></pre></div><p>补充如下代码即可解决</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=color:#f92672>before_install</span>:
- <span style=color:#ae81ff>openssl aes-256-cbc -K $encrypted_0ad490829f5d_key -iv $encrypted_0ad490829f5d_iv</span>
  -<span style=color:#ae81ff>in id_rsa.enc -out ~/.ssh/id_rsa -d</span>
- <span style=color:#ae81ff>chmod 600 ~/.ssh/id_rsa</span>
</code></pre></div><p>完成上述的操作之后，你的代码应该就能自动化的部署了。不是很难，确保每个步骤无误，就肯定没问题了。如果还有问题，可以 Google、看官方文档，也可以问我。</p><p>代码可见 <a href=https://github.com/vdorchan/vue-movie>https://github.com/vdorchan/vue-movie</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://vdorchan.github.io/tags/travis-ci/>Travis-CI</a></li><li><a href=https://vdorchan.github.io/tags/%E7%BD%91%E7%AB%99%E9%83%A8%E7%BD%B2/>网站部署</a></li></ul><nav class=paginav><a class=prev href=https://vdorchan.github.io/posts/vue-ken/><span class=title>« Prev Page</span><br><span>使用 vue 开发项目遇到的问题总结</span></a>
<a class=next href=https://vdorchan.github.io/posts/deploy-lets-encrypt-ssl-certificate-with-certbot/><span class=title>Next Page »</span><br><span>通过 certbot 给网站部署 Let’s Encrypt SSL 安全证书</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 使用 Travis-CI 完成高级的自动化部署 on twitter" href="https://twitter.com/intent/tweet/?text=%e4%bd%bf%e7%94%a8%20Travis-CI%20%e5%ae%8c%e6%88%90%e9%ab%98%e7%ba%a7%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e9%83%a8%e7%bd%b2&url=https%3a%2f%2fvdorchan.github.io%2fposts%2fset-up-advanced-automatic-deployment-with-travis-ci%2f&hashtags=Travis-CI%2c%e7%bd%91%e7%ab%99%e9%83%a8%e7%bd%b2"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 使用 Travis-CI 完成高级的自动化部署 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fvdorchan.github.io%2fposts%2fset-up-advanced-automatic-deployment-with-travis-ci%2f&title=%e4%bd%bf%e7%94%a8%20Travis-CI%20%e5%ae%8c%e6%88%90%e9%ab%98%e7%ba%a7%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e9%83%a8%e7%bd%b2&summary=%e4%bd%bf%e7%94%a8%20Travis-CI%20%e5%ae%8c%e6%88%90%e9%ab%98%e7%ba%a7%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e9%83%a8%e7%bd%b2&source=https%3a%2f%2fvdorchan.github.io%2fposts%2fset-up-advanced-automatic-deployment-with-travis-ci%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 使用 Travis-CI 完成高级的自动化部署 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fvdorchan.github.io%2fposts%2fset-up-advanced-automatic-deployment-with-travis-ci%2f&title=%e4%bd%bf%e7%94%a8%20Travis-CI%20%e5%ae%8c%e6%88%90%e9%ab%98%e7%ba%a7%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e9%83%a8%e7%bd%b2"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 使用 Travis-CI 完成高级的自动化部署 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fvdorchan.github.io%2fposts%2fset-up-advanced-automatic-deployment-with-travis-ci%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 使用 Travis-CI 完成高级的自动化部署 on whatsapp" href="https://api.whatsapp.com/send?text=%e4%bd%bf%e7%94%a8%20Travis-CI%20%e5%ae%8c%e6%88%90%e9%ab%98%e7%ba%a7%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e9%83%a8%e7%bd%b2%20-%20https%3a%2f%2fvdorchan.github.io%2fposts%2fset-up-advanced-automatic-deployment-with-travis-ci%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 使用 Travis-CI 完成高级的自动化部署 on telegram" href="https://telegram.me/share/url?text=%e4%bd%bf%e7%94%a8%20Travis-CI%20%e5%ae%8c%e6%88%90%e9%ab%98%e7%ba%a7%e7%9a%84%e8%87%aa%e5%8a%a8%e5%8c%96%e9%83%a8%e7%bd%b2&url=https%3a%2f%2fvdorchan.github.io%2fposts%2fset-up-advanced-automatic-deployment-with-travis-ci%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://vdorchan.github.io/>Two Cold</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>